--- fs/ubifs/dir.c
+++ fs/ubifs/dir.c
@@ -467,23 +466,16 @@ static int ubifs_readdir(struct file *file, void *dirent, filldir_t filldir)
 	}
 
 out:
+	if (err != -ENOENT) {
+		ubifs_err("cannot find next direntry, error %d", err);
+		return err;
+	}
+
 	kfree(file->private_data);
 	file->private_data = NULL;
-
-	if (err != -ENOENT)
-		ubifs_err("cannot find next direntry, error %d", err);
-	else
-		/*
-		 * -ENOENT is a non-fatal error in this context, the TNC uses
-		 * it to indicate that the cursor moved past the current directory
-		 * and readdir() has to stop.
-		 */
-		err = 0;
-
-
 	/* 2 is a special value indicating that there are no more direntries */
 	file->f_pos = 2;
-	return err;
+	return 0;
 }
 
 static loff_t ubifs_dir_llseek(struct file *file, loff_t offset, int whence)
